<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Side Project: Power Cards | TIMBERTECH</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="One of the many shortcomings of my technology toolkit is C++. I’ve tinkered with it here and there over the years, but the vast majority of my time and energy has gone into easier languages such as C#">
<meta property="og:type" content="article">
<meta property="og:title" content="Side Project: Power Cards">
<meta property="og:url" content="http://timberjaw.github.io/2015/07/31/side-project-power-cards/index.html">
<meta property="og:site_name" content="TIMBERTECH">
<meta property="og:description" content="One of the many shortcomings of my technology toolkit is C++. I’ve tinkered with it here and there over the years, but the vast majority of my time and energy has gone into easier languages such as C#">
<meta property="og:image" content="http://timberjaw.github.io/2015/07/31/side-project-power-cards/ExampleCard.png">
<meta property="og:updated_time" content="2015-12-29T00:09:42.467Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Side Project: Power Cards">
<meta name="twitter:description" content="One of the many shortcomings of my technology toolkit is C++. I’ve tinkered with it here and there over the years, but the vast majority of my time and energy has gone into easier languages such as C#">
  
  
  
 <link href='https://fonts.googleapis.com/css?family=Open+Sans:400italic,400,600' rel='stylesheet' type='text/css'>
 <link href='https://fonts.googleapis.com/css?family=Source+Code+Pro' rel='stylesheet' type='text/css'>

<link href="http://fonts.googleapis.com/css?family=Roboto+Condensed:400,700" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=Open+Sans:400,700" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css" type="text/css">
  

  

  
</head>
<body>
  <div id="container">
    <header id="header">
  <div id="header-main" class="header-inner">
    <div class="outer">
      <a href="/" id="logo"><span class="site-title">TIMBERTECH</span></a>
      <span class="site-subtitle">DATA COLLECTOR MK IV</span>
      <nav id="main-nav">
        
      </nav>
      
    </div>
  </div>
  <div id="main-nav-mobile" class="header-sub header-inner">
    <table class="menu outer">
      <tr>
        
        <td>
          
            <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><input type="hidden" name="sitesearch" value="http://timberjaw.github.io"></form>
          
        </td>
      </tr>
    </table>
  </div>
</header>

    <div class="outer">
      
      <section id="main"><article id="post-side-project-power-cards" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Side Project: Power Cards
    </h1>
  

        <div class="article-meta">
          
  <div class="article-date">
    <i class="fa fa-calendar"></i>
    <a href="/2015/07/31/side-project-power-cards/">
      <time datetime="2015-07-31T07:00:00.000Z" itemprop="datePublished">2015-07-31</time>
    </a>
  </div>


          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
                
        <p>One of the many shortcomings of my technology toolkit is C++. I’ve tinkered with it here and there over the years, but the vast majority of my time and energy has gone into easier languages such as C#, Java, and PHP. I set out to rectify that recently by 1) borrowing a copy of <a href="http://amzn.com/0201889544" target="_blank" rel="external">The C++ Programming Language</a> from a generous friend, and 2) diving into a hands-on project well beyond my capabilities. If learning by beating your head against a compiler was a valid way of learning programming, I’d be a Computer Science professor.</p>
<h2 id="The_Project"><a href="#The_Project" class="headerlink" title="The Project"></a>The Project</h2><p>I currently GM two systems: Dungeons &amp; Dragons 5th Edition, and <a href="http://www.numenera.com/" target="_blank" rel="external">Numenera</a> (a more recent system by former D&amp;D designer Monte Cook). For D&amp;D, Wizards of the Coast had a set of “power cards” produced for every spell in the game. They’re standard playing card size, excellent quality (sturdy and laminated), and big time-savers at the table, especially for newer players or anyone with an inordinate number of spells (hello Wizard!). For most spells it’s no longer necessary to look them up in the rulebook (a few have too much information to fit on a card).</p>
<p>Numenera doesn’t have power cards. Maybe they’ll get around to it at some point (they’ve released card decks for random items and XP). In the meantime, it seemed like a fun project. The basic idea is:</p>
<ol>
<li>Copy the powers (Esoteries for the Nano type/class, Tricks of the Trade for Jacks, and Fighting Moves for Glaives) from the source book(s).</li>
<li>Organize the powers in Excel (separating fields for character type, power tier, title, description, cost and so forth).</li>
<li>Export to CSV.</li>
<li>Import the CSV in my C++ program, loop through the entries and output nicely-formatted card images using ImageMagick.</li>
<li>Print the cards, either on cardstock at home or via a print service / shop.</li>
</ol>
<h2 id="Step_One_3A_Learn_C++"><a href="#Step_One_3A_Learn_C++" class="headerlink" title="Step One: Learn C++"></a>Step One: Learn C++</h2><p>This process will continue through every other step and beyond. C++ requires more attention to things like memory management, use of references/pointers, and in general has a less friendly syntax than a language like C#. I have several blocks of code that work for reasons still unknown to me, and several things I tried previously failed to work due to equally mysterious causes.</p>
<h2 id="Step_Two_3A_Learn_ImageMagick"><a href="#Step_Two_3A_Learn_ImageMagick" class="headerlink" title="Step Two: Learn ImageMagick"></a>Step Two: Learn ImageMagick</h2><p>I spent way more time on this step than I should have. Most of it can be explained by my inexperience with C++ (and with native Windows development), but it <em>seems</em> like there are a few areas where ImageMagick’s actual behavior doesn’t match its documentation. I eventually got it compiled and working with my program (while learning a lot about lib files and DLL loading along the way).</p>
<p>Once I had the library working, drawing elements to an image and saving it was surprisingly easy. Working with text, however, is another story. Among other issues, ImageMagick doesn’t seem to have built-in support for text wrapping. Since I need to write decent-sized chunks of text and I don’t feel like using a monospaced font, I ended up writing what may be the worst text wrapping function of all time.</p>
<h2 id="Step_Three_3A_Write_the_Worst_Text-Wrapping_Function_of_All_Time"><a href="#Step_Three_3A_Write_the_Worst_Text-Wrapping_Function_of_All_Time" class="headerlink" title="Step Three: Write the Worst Text-Wrapping Function of All Time"></a>Step Three: Write the Worst Text-Wrapping Function of All Time</h2><p>Ok. So there’s no built-in text wrapping. There’s also no built-in way to measure the size of a piece of text. I <em>think</em> there’s a non-ImageMagick way to get the font data that would let me do that, but at this point my head is already full of too much other new information. So I decided to work around the issue using only ImageMagick’s functionality and plain C++. I noticed that when drawing text, you can specify a background color, which will draw a colored rectangle behind the text. You can also sample pixels from anywhere in the image, which turns out to be pretty handy.</p>
<p>Here’s how the text wrap works:</p>
<ul>
<li>Set the background color AND the text color to red</li>
<li>Write the text onto a temp image</li>
<li>Get a pixel at the right side of the image</li>
<li>If the pixel is red, the text is too long to fit on the line</li>
<li>Cut a word from the end of the text and try again</li>
<li>If it’s stupid but it works, it’s not stupid</li>
</ul>
<p>I did perform some optimizations, as this turned out to be (predictably) slow with longer strings. In particular, I picked a semi-arbitrary character count that I think is unlikely to ever fit on a single line, and I only write/check that amount of text at a time. If I have 800 characters of text to write, chances are no more than about 50 characters will fit on each line (for the font size and image size I’m using). This reduces the number of failed attempts for each line considerably. Each time I write a line, I get the next ~50 characters, move down to the next line and continue.</p>
<p>The function currently lacks a few features (some more important than others):</p>
<ul>
<li>Doesn’t handle overflow off the bottom of the image</li>
<li>Doesn’t minimize wasted space at ends of lines (e.g. sometimes it might be better to leave a larger gap at the end of one line to use the next few more optimally)</li>
<li>Only handles left or right alignment; I’d like to have the text justified</li>
</ul>
<h2 id="Step_4_3A_Tidy_Up_and_Print_21"><a href="#Step_4_3A_Tidy_Up_and_Print_21" class="headerlink" title="Step 4: Tidy Up and Print!"></a>Step 4: Tidy Up and Print!</h2><p>With the basic functionality working, I put some time into cleaning up the output, designing some card backs, and doing general cleanup. I’m almost ready to print the actual cards.</p>
<img src="/2015/07/31/side-project-power-cards/ExampleCard.png" alt="Example card" title="Example card">

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timberjaw.github.io/2015/07/31/side-project-power-cards/" data-id="ciix1c5ng004874oh9c3gt5qj" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cplusplus/">cplusplus</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/numenera/">numenera</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2015/08/01/stupidrpg-callbacks/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          StupidRPG: Callbacks
        
      </div>
    </a>
  
  
    <a href="/2015/07/30/stupidrpg-the-rpg/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">StupidRPG: The RPG</div>
    </a>
  
</nav>


  
</article>


</section>
      
    </div>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 Steven Richards<br>
    </div>
  </div>
</footer>
    





 <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>





<script src="/js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>